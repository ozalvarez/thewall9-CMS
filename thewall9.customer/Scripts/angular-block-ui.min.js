/*!
   angular-block-ui v0.1.2
   (c) 2014 (null) McNull https://github.com/McNull/angular-block-ui
   License: MIT
*/
(function(n){var t=n.module("blockUI",[]);t.config(["$provide","$httpProvider",function(n,t){n.decorator("$exceptionHandler",["$delegate","$injector",function(n,t){var i,r;return function(u,f){if(r=r||t.get("blockUIConfig"),r.resetOnException)try{i=i||t.get("blockUI");i.instances.reset()}catch(e){console.log("$exceptionHandler",u)}n(u,f)}}]);t.interceptors.push("blockUIHttpInterceptor")}]);t.run(["$document","blockUIConfig","$templateCache",function(n,t,i){t.autoInjectBodyBlock&&n.find("body").attr("block-ui","main");t.template&&(t.templateUrl="$$block-ui-template$$",i.put(t.templateUrl,t.template))}]);t.directive("blockUiContainer",["blockUIConfig","blockUiContainerLinkFn",function(n,t){return{scope:!0,restrict:"A",templateUrl:n.templateUrl,compile:function(){return t}}}]).factory("blockUiContainerLinkFn",["blockUI","blockUIUtils",function(){return function(n,t){var i=t.inheritedData("block-ui");if(!i)throw new Error("No parent block-ui service instance located.");n.state=i.state()}}]);t.directive("blockUi",["blockUiCompileFn",function(n){return{scope:!0,restrict:"A",compile:n}}]).factory("blockUiCompileFn",["blockUiPreLinkFn",function(n){return function(t){return t.append('<div block-ui-container class="block-ui-container"><\/div>'),{pre:n}}}]).factory("blockUiPreLinkFn",["blockUI","blockUIUtils","blockUIConfig",function(n,t,i){return function(r,u,f){var o,e,c,s,h,l;u.hasClass("block-ui")||u.addClass(i.cssClass);f.$observe("blockUiMessageClass",function(n){r.$_blockUiMessageClass=n});o=f.blockUi||"_"+r.$id;e=n.instances.get(o);o==="main"&&i.preventRouting?c=r.$on("$viewContentLoaded",function(){c();r.$on("$locationChangeStart",function(n){e.state().blockCount>0&&n.preventDefault()})}):(s=u.inheritedData("block-ui"),s&&(e._parent=s));r.$on("$destroy",function(){e.release()});e.addRef();r.$_blockUiState=e.state();r.$watch("$_blockUiState.blocking",function(n){u.attr("aria-busy",!!n);u.toggleClass("block-ui-visible",!!n)});r.$watch("$_blockUiState.blockCount > 0",function(n){u.toggleClass("block-ui-active",!!n)});h=f.blockUiPattern;h&&(l=t.buildRegExp(h),e.pattern(l));u.data("block-ui",e)}}]);t.constant("blockUIConfig",{templateUrl:"angular-block-ui/angular-block-ui.ng.html",delay:250,message:"Loading ...",autoBlock:!0,resetOnException:!0,requestFilter:n.noop,autoInjectBodyBlock:!0,cssClass:"block-ui block-ui-anim-fade",preventRouting:!0});t.factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig","$templateCache",function(n,t,i,r){function f(){u=u||t.get("blockUI")}function e(n){i.autoBlock&&n&&!n.$_noBlock&&n.$_blocks&&(f(),n.$_blocks.stop())}function o(t){try{e(t.config)}catch(i){console.log("httpRequestError",i)}return n.reject(t)}var u;return{request:function(n){if(i.autoBlock&&!(n.method=="GET"&&r.get(n.url))){var t=i.requestFilter(n);t===!1?n.$_noBlock=!0:(f(),n.$_blocks=u.instances.locate(n),n.$_blocks.start(t))}return n},requestError:o,response:function(n){return n&&e(n.config),n},responseError:o}}]);t.factory("blockUI",["blockUIConfig","$timeout","blockUIUtils","$document",function(t,i,r,u){function s(f){var s=this,h={id:f,blockCount:0,message:t.message,blocking:!1},c,l=[];this._id=f;this._refs=0;this.start=function(f){f=h.blockCount>0?f||h.message||t.message:f||t.message;h.message=f;h.blockCount++;var e=n.element(u[0].activeElement);e.length&&r.isElementInBlockScope(e,s)&&(s._restoreFocus=e[0],i(function(){s._restoreFocus&&s._restoreFocus.blur()}));c||(c=i(function(){c=null;h.blocking=!0},t.delay))};this._cancelStartTimeout=function(){c&&(i.cancel(c),c=null)};this.stop=function(){h.blockCount=Math.max(0,--h.blockCount);h.blockCount===0&&s.reset(!0)};this.message=function(n){h.message=n};this.pattern=function(n){return n!==undefined&&(s._pattern=n),s._pattern};this.reset=function(t){s._cancelStartTimeout();h.blockCount=0;h.blocking=!1;s._restoreFocus&&(!u[0].activeElement||u[0].activeElement===o[0])&&(s._restoreFocus.focus(),s._restoreFocus=null);try{t&&n.forEach(l,function(n){n()})}finally{l.length=0}};this.done=function(n){l.push(n)};this.state=function(){return h};this.addRef=function(){s._refs+=1};this.release=function(){--s._refs<=0&&e.instances._destroy(s)}}var o=u.find("body"),f=[],e;return f.get=function(n){if(!isNaN(n))throw new Error("BlockUI id cannot be a number");var t=f[n];return t||(t=f[n]=new s(n),f.push(t)),t},f._destroy=function(t){if(n.isString(t)&&(t=f[t]),t){t.reset();var i=r.indexOf(f,t);f.splice(i,1);delete f[t.state().id]}},f.locate=function(n){var t=[],i,u,o;for(r.forEachFnHook(t,"start"),r.forEachFnHook(t,"stop"),i=f.length;i--;)u=f[i],o=u._pattern,o&&o.test(n.url)&&t.push(u);return t.length===0&&t.push(e),t},r.forEachFnHook(f,"reset"),e=f.get("main"),e.addRef(),e.instances=f,e}]);t.factory("blockUIUtils",function(){var i=n.element,t={buildRegExp:function(n){var t=n.match(/^\/(.*)\/([gim]*)$/),i;if(t)i=new RegExp(t[1],t[2]);else throw Error("Incorrect regular expression format: "+n);return i},forEachFn:function(n,t,i){for(var u=n.length,r;u--;)r=n[u],r[t].apply(r,i)},forEachFnHook:function(n,i){n[i]=function(){t.forEachFn(this,i,arguments)}},isElementInBlockScope:function(n,t){for(var i=n.inheritedData("block-ui");i;){if(i===t)return!0;i=i._parent}return!1},findElement:function(n,r,u){var f=null,e,o;if(r(n))f=n;else for(e=u?n.parent():n.children(),o=e.length;!f&&o--;)f=t.findElement(i(e[o]),r,u);return f},indexOf:function(n,t,i){for(var r=i||0,u=n.length;r<u;r++)if(n[r]===t)return r;return-1}};return t});n.module("blockUI").run(["$templateCache",function(n){n.put("angular-block-ui/angular-block-ui.ng.html",'<div class="block-ui-overlay"><\/div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass">{{ state.message }}<\/div><\/div>')}])})(angular);
//# sourceMappingURL=angular-block-ui.min.js.map
